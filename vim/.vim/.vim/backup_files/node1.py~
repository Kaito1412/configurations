# -*- coding: utf-8 -*-
import logging
import sys
import os

#CPD
CPD = "madrid.gigas.com"

# CONSOLA
CONSOLE = "node1"

# IPS
ONAPP_IP = "10.0.40.10"
###HAL_IP = "10.0.40.10"
HAL_IP = "0.0.0.0"
HAL_PORT = "8888"

#OnApp
ONAPP_DB = "mysql://toni.valverde:my$$@%s/onapp?charset=utf8" % ONAPP_IP
POOL_RECYCLE = 60  #mantén este valor siempre por debajo del valor de wait_timeout de mysql
ONAPP_API_URL = "http://%s" % ONAPP_IP
ONAPP_USER = "apiguser@gigas.com"
ONAPP_PASS = "3cafecd660d0a2f2e35e69159ac73fa3d20ffa22"
ONAPP_AUTHENTICATION_KEY = "476aede036db8e3341345e2dfb95c71caa2f2c5a"
HV_PUBLIC_INTERFACE = "eth0"
FIRST_VLAN = 310
PARKING_VLAN = 309
VIP_LIMIT = 254
ID_RSA_PATH = "/root/.ssh/id_rsa"

#GigasHal
###HAL_DB = "mysql://root:gigashosting@%s/gigas_hal?charset=utf8" % ONAPP_IP
HAL_DB = "mysql://root:root@db_mysql/gigas_hal?charset=utf8"

#RRD
RRD_PATH = '/tmp/rrds/bw'
RRD_GRAPH_PATH = os.path.join(os.path.dirname(__file__), 'static/graph')
RRD_BAL_PATH = "/tmp/rrds/balancer"
RRD_CPU_PATH = "/tmp/rrds/cpu"
GIGAS_STATS_PATH = "/tmp/gigas/stats"

#TASKMANAGER (RabbitMQ)
BACKUP_SERVER = 1  # En HAL el valor debe ser None y en el server de backup debe ser el id de ese server, ej: 1, 2, etc

__QUEUES = [None,]  # El indice 0 no se usa y debe ser siempre None
__EXCHANGES = [None,]  # El indice 0 no se usa y debe ser siempre None
__ROUTING = {}
for bserver in [1, 2]:
    if BACKUP_SERVER and bserver != BACKUP_SERVER:
        __QUEUES.append(None)  # En el server de backup solo añadirmos las colas de ese server
        __EXCHANGES.append(None)  # Lo mismo para los exchange
        continue
    server = 'server{0}'.format(bserver)
    __QUEUES.append({"backup": "%s.%s.backup" % (server, CONSOLE),
                   "backup.low": "%s.%s.backup.low" % (server, CONSOLE),
                   "disk": "%s.%s.disk" % (server, CONSOLE)})
    __EXCHANGES.append("%s.%s.%s" % (server, CONSOLE, CPD))
    __ROUTING["%s.%s.%s" % (server, CONSOLE, CPD)] = (  # exchange_name
            {"routing_key": "%s.backup" % CONSOLE, "queue": "%s.%s.backup" % (server, CONSOLE)},
            {"routing_key": "%s.backup.low" % CONSOLE, "queue": "%s.%s.backup.low" % (server, CONSOLE)},
            {"routing_key": "%s.disk" % CONSOLE, "queue": "%s.%s.disk" % (server, CONSOLE)},
            {"routing_key": "%s.tpl" % CONSOLE, "queue": "%s.%s.backup" % (server, CONSOLE)},
        )

__EXCHANGES.append("%s.%s" % (CONSOLE, CPD))
__DEFAULT_QUEUES = {"backup": "%s.backup" % (CONSOLE),
                   "backup.low": "%s.backup.low" % (CONSOLE),
                   "disk": "%s.disk" % (CONSOLE)}
__ROUTING["%s.%s" % (CONSOLE, CPD)] = (  # exchange_name
            {"routing_key": "%s.backup" % CONSOLE, "queue": "%s.backup" % (CONSOLE)},
            {"routing_key": "%s.backup.low" % CONSOLE, "queue": "%s.backup.low" % (CONSOLE)},
            {"routing_key": "%s.disk" % CONSOLE, "queue": "%s.disk" % (CONSOLE)},
            {"routing_key": "%s.tpl" % CONSOLE, "queue": "%s.backup" % (CONSOLE)},
        )

TASKCONFIG = {
    ###"host": "dev.gigas.local",
    "host": "rabbitmq",
    "port": "5672",
    "userid": "guest",
    "password": "guest",
    "virtual_host": "/",
    "exchange_type": "topic",
    "queues": __QUEUES,
    "default_queues": __DEFAULT_QUEUES,
    "exchange_name": __EXCHANGES,
    "routing": __ROUTING,
}

#MONITOR
HYP_DIR = '/tmp/hypervisor'
HYP_STATUS_FILE = '/tmp/hyp_status'
HYP_TIMEDELTA = 3
HYP_STATUS = (0, 1, 2)
HYP_FAILOVER_LOG_PATH = '/tmp'

#BALANCER
BAL_PORT = 5034
BAL_SERVICE_FILE_PATH="/root/service_file"
BAL_ALERTS_FILE = "/root/sendalerts.py"

#Tornado
TORNADO_STATIC_DIR = os.path.join(os.path.dirname(__file__), "static")
DEBUG = True 
BIND_IP = HAL_IP
BIND_PORT = HAL_PORT
ENABLE_TORNADIO2 = False

#LOG
LOG_PATH = '/tmp/hal.log'
FORMAT = '%(asctime)s:%(levelname)s:%(name)s:%(funcName)s:%(message)s'
logging.basicConfig(format=FORMAT, filename=LOG_PATH, level=DEBUG and logging.DEBUG or logging.INFO)
log = logging.getLogger('hal')

#BACKUP
BACKUP_TMPLOG_PATH = "/var/tmp/backup/log"
BACKUP_TIMEOUT = 60*60

#BACKUP REMOTE
BACKUP_NODE = None  #'backup'
BACKUP_HOST = "10.0.40.199"
BACKUP_USERNAME = None  #"toni.valverde"
BACKUP_PASSWORD = None
BACKUP_KEY_FILENAME = None  #"/home/gigas/.ssh/gigas_rsa"
BACKUP_BIN_PATH = None  #"/home/toni.valverde/bin"

#PROVISION
MIN_FREE_RAM = 10  #Porcentaje
SAS_TIERS = [4]
SATA_TIERS = [3]

#FAILOVER
ILO_IP = {
            'HV1': '10.0.40.110',
            'HV2': '10.0.40.111',
        }
ILO_LOGIN = 'monitor'
ILO_PASS = 'hat3st111'
ILO_KEY_FILENAME = None

# RESIZE
resize_host = "10.0.40.199"

# KEEP
KEEP_TYPES = ["gigas-automatic"] # esta establece que tipo de backups son los que hay que mantener
BACKUP_LIMBO_DISK = 1 # esta establece cual es el id disco a usar como disco de keep

#KAYAKO
URL = "https://dev.gigas.local/support/api/index.php?"
KEY = "54c03a95-404a-87a4-5571-b5a537223416"
SECRET = "ZWFkZTY2NjktMWFjYi05ZjI0LTI1NzEtMTcxNDE5Mzg5NDQyZjI5MzNmOWQtZDAyMi1jZGE0LTgxMTgtNjY3NDQyOWY2YzA3"
